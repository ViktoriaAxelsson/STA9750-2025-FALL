<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.22">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Viktoria, Eveline, Nuzhat, Sakib">
<meta name="dcterms.date" content="2025-12-10">

<title>Understanding Global Happiness Through Economic, Social, and Institutional Factors – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-cd7454b418030687c631a6a7286fbe16.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0fd445826db4cc1007072b2af7a3b60c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-motivations-and-importance-of-analysis" id="toc-introduction-motivations-and-importance-of-analysis" class="nav-link active" data-scroll-target="#introduction-motivations-and-importance-of-analysis">Introduction: motivations and importance of analysis</a></li>
  <li><a href="#how-specific-analyses-help-to-address-the-motivating-question" id="toc-how-specific-analyses-help-to-address-the-motivating-question" class="nav-link" data-scroll-target="#how-specific-analyses-help-to-address-the-motivating-question">How specific analyses help to address the motivating question</a></li>
  <li><a href="#visualization-of-most-important-findings" id="toc-visualization-of-most-important-findings" class="nav-link" data-scroll-target="#visualization-of-most-important-findings">Visualization of most important findings</a>
  <ul class="collapse">
  <li><a href="#corruption" id="toc-corruption" class="nav-link" data-scroll-target="#corruption">Corruption</a></li>
  <li><a href="#weather" id="toc-weather" class="nav-link" data-scroll-target="#weather">Weather</a></li>
  <li><a href="#vacation-vs-income" id="toc-vacation-vs-income" class="nav-link" data-scroll-target="#vacation-vs-income">Vacation vs Income</a></li>
  </ul></li>
  <li><a href="#relation-to-prior-work" id="toc-relation-to-prior-work" class="nav-link" data-scroll-target="#relation-to-prior-work">Relation to prior work</a></li>
  <li><a href="#potential-next-steps" id="toc-potential-next-steps" class="nav-link" data-scroll-target="#potential-next-steps">Potential next steps</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Understanding Global Happiness Through Economic, Social, and Institutional Factors</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Viktoria, Eveline, Nuzhat, Sakib </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 10, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="world.png" class="img-fluid"></p>
<section id="introduction-motivations-and-importance-of-analysis" class="level2">
<h2 class="anchored" data-anchor-id="introduction-motivations-and-importance-of-analysis">Introduction: motivations and importance of analysis</h2>
<p>This analysis aims to better understand the factors that truly impact quality of life across countries worldwide. While happiness is often discussed broadly, our study seeks to identify which economic, environmental, and social variables are most strongly associated with national well-being.</p>
<p>The findings have practical implications for both organizations and policymakers. For companies, the analysis can help inform decisions about employee incentives by comparing the relative importance of factors such as salary levels versus work-life balance measures like paid vacation time. For governments, this research can provide evidence-based insights to guide public policy focused on improving societal well-being, including investments in income growth, anti-corruption efforts, labor regulations, and quality-of-life initiatives.</p>
<p>Overall, by combining multiple global datasets and examining changes over time, this analysis contributes to a more comprehensive understanding of happiness and well-being and highlights actionable areas for improving quality of life at both the organizational and national levels.</p>
<p>Beyond identifying which factors matter most, this study also helps clarify how their importance can change as countries develop. Our results suggest that while economic growth remains essential, especially in lower-income contexts, non-economic factors such as trust in institutions and work-life balance become increasingly important once basic needs are met.</p>
<p>By highlighting these shifts, the analysis encourages a more balanced approach to improving well-being, one that goes beyond income alone and focuses on creating societies where people not only live better, but also feel better about their lives.</p>
</section>
<section id="how-specific-analyses-help-to-address-the-motivating-question" class="level2">
<h2 class="anchored" data-anchor-id="how-specific-analyses-help-to-address-the-motivating-question">How specific analyses help to address the motivating question</h2>
<p>Our analysis directly addresses the motivating question by examining how different economic, environmental, and social factors relate to national happiness and quality of life. We look at these variables across countries and over time.</p>
<p>By using data from multiple years, we can see trends and how events like economic changes, policy reforms, or corruption scandals affect happiness. This helps us understand not just which countries are happiest, but why happiness changes over time.</p>
<p>We compare several factors to see which have the biggest impact on happiness. These include income (GDP per capita), work-life balance (paid vacation days), environment (temperature and precipitation), and governance (corruption perception). This lets us explore questions like: Are people happier in warmer countries? Does earning more money make people happier? Do more vacation days improve well-being? How does corruption affect happiness?</p>
<p>We use analyses to measure how strongly these factors are related to happiness. Looking at these patterns across countries and over time shows whether relationships are consistent or vary by context.</p>
<p>We also use country-specific case studies to examine particular events, such as corruption scandals or policy changes, and how they affect happiness. By combining objective measures (income, vacation days, weather, corruption trends) with subjective happiness scores, we can get a clearer picture of what influences well-being.</p>
<p>Our data comes from a variety of sources. The World Happiness Report provides happiness scores and factors for most countries. We also use the World Bank for climate data and the OECD for vacation and leisure hours. Combining these sources allows us to study both objective and subjective influences on happiness.</p>
<p>Overall, this approach helps us understand which factors affect national happiness and how they work together. It also gives insights that policymakers and organizations can use to improve well-being. By comparing economic incentives with quality-of-life factors, our analysis highlights how priorities may shift once basic needs are met, offering practical guidance for designing policies and workplace incentives that better support long-term happiness.</p>
<p>Choice of data used, including discussion of any limitations; Our primary dataset is the World Happiness Report, which provides annual happiness (ladder) scores and contributing factors for most countries worldwide. This dataset is clean and well-structured, with only a small number of countries having limited score data, making it suitable for cross-country comparison in specific years. The inclusion of standardized ladder scores and factor columns (such as GDP per capita and perceptions of corruption) allows for easy comparison and integration with other datasets. To analyze trends over time, we use yearly versions of the dataset, which are continuously updated to maintain relevance. However, happiness remains a subjective measure and may be influenced by cultural differences in how well-being is reported.</p>
<p>To supplement this dataset, we incorporate data from the World Bank Group and the OECD, which provide reliable and consistent annual records on weather conditions and average paid vacation days. These datasets align well with our research purpose by capturing environmental and lifestyle factors that may influence national happiness. Country and year identifiers align closely with those in the World Happiness dataset, enabling multivariable analysis. While coverage is comprehensive, some missing values exist for small island nations or territories. Additionally, definitions across datasets may vary, which can make direct comparisons more challenging and requires careful data alignment.</p>
<p>We also use the Corruption Perceptions Index (CPI) from Our World in Data to assess corruption more objectively. While the happiness dataset reflects perceptions of how corruption affects well-being, it does not measure actual corruption levels. The CPI provides country-level scores from 2019–2025 based on expert assessments and surveys, allowing us to compare corruption levels with happiness rankings in greater depth. Nonetheless, the CPI remains perception-based and should be interpreted cautiously.</p>
<p>Several broader limitations apply across all datasets. The COVID-19 pandemic may have influenced data from 2022–2023, particularly in areas such as income, vacation availability, and reported happiness. Additionally, while our analysis explores relationships between variables such as GDP, climate, vacation days, corruption, and happiness, correlation does not imply causation, and observed associations may not reflect direct causal effects. Finally, combining multiple continuously updated data sources requires careful alignment across countries and years, which may introduce minor inconsistencies.</p>
</section>
<section id="visualization-of-most-important-findings" class="level2">
<h2 class="anchored" data-anchor-id="visualization-of-most-important-findings">Visualization of most important findings</h2>
<p>To clearly communicate the key insights from our analysis, we created a set of visualizations that highlight the main factors influencing national happiness. Scatter plots are used to show the relationship between GDP per capita and happiness scores, illustrating how income levels relate to well-being across countries. These plots are further strengthened by grouping countries into income categories, which makes it easier to compare patterns among low-, middle-, and high-income nations.</p>
<section id="corruption" class="level3">
<h3 class="anchored" data-anchor-id="corruption">Corruption</h3>
<p><img src="corruptionnew.png" class="img-fluid"></p>
<p>This visualization for corruption In 2023, shows how countries with low corruption tend to rank higher in happiness, including Finland (CPI 87) and Denmark (CPI 90) that are the two happiest countries.</p>
<p>Most corrupt countries generally rank lower, though suprisingly there are exceptions: Nicaragua (high corruption) ranks 43rd, Mexico 25th, and Kuwait 13th.</p>
<p>In addition, some low-corruption countries, like Singapore (CPI 83), do not rank among the very happiest, showing other factors also influence happiness.</p>
<p><img src="linecharts.png" class="img-fluid"></p>
<p>When focusing on a specific country - Uzbekistan, we find that between 2023–2024, changes in corruption levels corresponded with shifts in happiness, implying corruption has influence on the country’s well-being.In 2023, it also coincided with a presidential election, and more government transparency.</p>
<p>However, surprisingly in 2019, happiness peaked despite relatively high corruption. This is likely due to other factors driving happiness more than corruption, such as many reforms taking place during this time—including job creation, and improvements in health, education, and infrastructure.</p>
</section>
<section id="weather" class="level3">
<h3 class="anchored" data-anchor-id="weather">Weather</h3>
<p>Additional scatter plots examine environmental factors such as average temperature and precipitation alongside lifestyle indicators like paid vacation days, helping us explore possible connections between climate, work-life balance, and happiness. What we found is that temperature does not strongly predict happiness, the least of all the factors we looked at. The warmest countries tend to be less happy, but this is likely due to economic and social factors, not heat itself. The coldest countries include some of the happiest in the world. Countries with moderate temperatures show mixed results. Overall, climate alone cannot explain national happiness .</p>
</section>
<section id="vacation-vs-income" class="level3">
<h3 class="anchored" data-anchor-id="vacation-vs-income">Vacation vs Income</h3>
<p>One central question asks how pay compares to time off in supporting well-being. While earnings are often seen as the main path to a good life, this work finds that their role shifts once people have enough to live on securely. To look at this more closely, we set side-by-side the links between national happiness and income, and between happiness and paid leave.</p>
<p>We used average income and mandated vacation days from international sources to see how each tied to life satisfaction scores. A clear trend emerges with income. In places where earnings are lower, rises in average income connect strongly to greater happiness. This link is clearest in less wealthy nations, where more money often means better basics: food, housing, medicine, and safety.</p>
<p>But in richer countries, the curve starts to level off. Further bumps in wealth link to only tiny gains in happiness. It seems that once needs are covered, more money alone does less for well-being. This fits with older ideas about money’s shrinking returns and backs the thought that finances count most up to a threshold.</p>
<p>Time off shows a different story. The tie between vacation days and happiness is less powerful than that for income in poorer places. Yet among wealthier nations, it gains relevance. Nations offering more leave often group at the higher end of happiness scales. This hints that balancing work and life matters more once people are financially set. While leave alone is not a strong predictor, it seems to add to quality of life where extra cash brings little added benefit.</p>
<p>Put together, these points suggest income and vacation are not rivals but follow a sequence. Money matters most when it helps meet fundamental needs. Benefits like time away grow in value once those foundations are secure. For employers, this means raises may boost satisfaction more for lower-paid staff, while extra leave or flexibility could mean more to those already earning well.</p>
<p>At the country level, this helps explain why nations with similar wealth sometimes report different happiness. Places that pair a solid economy with policies that support time outside work may see greater well-being than those focused only on income growth. It strengthens the project’s wider takeaway: happiness doesn’t hang on one thing, but on how economic security, trust in institutions, and day-to-day living conditions weave together over the long run.</p>
<p>Time series and line charts are used to track changes in happiness over multiple years. This allows us to observe how major global and country-specific events—such as economic crises, policy reforms, or corruption scandals—affect national well-being. These visualizations capture both short-term shocks and long-term trends, providing a more dynamic perspective than single-year analyses. For selected countries, we include focused case-study graphs that show shifts in happiness before and after significant events, offering deeper insight into how specific stressors or improvements influence people’s perceptions of well-being.</p>
<p>To present a comprehensive picture, we combine scatter plots, line charts, and grouped bar charts. Using multiple chart types allows us to highlight both relationships between variables and changes in happiness over time. Clear color coding, labeling, and well-designed legends improve readability and help make complex data patterns easier to understand. Overall, these visualizations not only emphasize key statistical relationships but also make the findings accessible to a broad audience, including policymakers, researchers, and the general public. By visually linking economic, environmental, and social factors to national happiness outcomes, the charts help translate quantitative results into meaningful, actionable insights for decision-making.</p>
<p>Beyond supporting the statistical results, these visualizations also help tell a clearer story about happiness. Seeing the data visually makes it easier to recognize patterns that might be overlooked in tables alone, such as where income gains begin to level off or where improvements in work-life balance align with higher happiness scores. In this way, the charts do more than present data—they help connect the numbers to real-world experiences, making the results more relatable and easier to apply to policy and organizational decisions.</p>
</section>
</section>
<section id="relation-to-prior-work" class="level2">
<h2 class="anchored" data-anchor-id="relation-to-prior-work">Relation to prior work</h2>
<p>The World Happiness Report and similar studies aim to understand how happiness is measured and already identify key factors associated with national happiness. To differentiate our work, we focus on how happiness scores have changed over time, particularly around major global and country specific events, to assess their impact.</p>
<p>Additionally, the original report does not directly incorporate variables such as weather conditions or average vacation days. We address this gap by supplementing the dataset with external sources to examine whether these factors also influence happiness.</p>
<p>Rather than analyzing all countries at a broad level, we also conduct deeper case studies of select countries experiencing notable events, such as corruption scandals. This approach allows us to better understand how specific stressors or improvements shape happiness trends.</p>
<p>Finally, we combine multiple reputable global datasets including the World Bank, OECD, and Our World in Data to provide a multidimensional perspective. By analyzing both objective measures such as GDP, temperature, and vacation days and subjective measures such as happiness scores and perceptions of corruption, we explore how different types of variables interact to influence happiness.</p>
<p>By taking this approach, our project moves beyond simple rankings and averages to better explain why happiness changes and which factors appear to matter most in different contexts. This helps bridge the gap between broad global studies and more applied, policy relevant insights. Our work also adds value by directly comparing economic incentives such as income growth with quality of life factors such as work life balance, offering a clearer picture of how priorities may shift as countries become wealthier. In doing so, we contribute to the existing literature by emphasizing that happiness is not driven by a single factor, but by the way economic, social, and institutional conditions work together over time.</p>
<p>In addition, our findings support and extend prior research that highlights diminishing returns to income, while also showing that non monetary factors can become increasingly important once basic economic needs are met.</p>
<p>By explicitly integrating work life balance and governance into the analysis, our study reinforces the idea that sustainable improvements in happiness require more than economic growth alone. This perspective aligns with and builds upon existing literature, while offering practical insights that can inform both public policy and organizational decision making.</p>
</section>
<section id="potential-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="potential-next-steps">Potential next steps</h2>
<p>Future research could expand on this analysis in several meaningful ways. One clear next step would be to include additional measures of well-being, such as mental health outcomes, access to healthcare, and education quality. While income and vacation time explain a large part of happiness differences across countries, they do not capture everything that shapes how people feel about their lives. Including these factors could help explain why some countries are happier than others even when their income levels or work-life balance policies are similar.</p>
<p>Another important extension would be to look at a longer time period, especially to better understand how countries recover from major shocks like the COVID-19 pandemic. Happiness levels during and after the pandemic were influenced by many temporary factors, and a longer time horizon would make it easier to separate short-term disruptions from lasting changes in well-being. Using more advanced statistical methods, such as fixed-effects or instrumental variable models, could also strengthen the analysis by helping distinguish correlation from causation and accounting for country-specific characteristics that do not change over time.</p>
<p>Future work could also benefit from including more in-depth country case studies. Looking closely at countries that have experienced major policy reforms, labor law changes, or shifts in corruption levels would provide a clearer picture of how these events affect happiness in practice. Comparing countries with different paths—for example, those that successfully reduced corruption versus those where corruption worsened—could offer valuable insights into which policies are most effective at improving well-being.</p>
<p>Finally, a particularly interesting direction for future research would be to more directly combine the different findings to identify clear “tipping points.” For instance, it would be useful to estimate the income level at which additional earnings no longer increase happiness as much as improvements in work-life balance, such as more vacation time. Identifying these thresholds would be highly relevant for both policymakers and employers, helping them design policies and incentive structures that better reflect what people actually value once their basic economic needs are met.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/viktoriaaxelsson\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>